<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Qu·∫£n l√Ω s·∫£n ph·∫©m</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>
  <div id="left-menu">
    <div id="logo">
      <img src="assets/img/logo1.png" alt="logo" />
    </div>
    <div id="menu">
      <div class="menu-item active"><a href="quanlysanpham.html"><i class="fa-solid fa-boxes-stacked"></i> Qu·∫£n l√Ω s·∫£n ph·∫©m</a></div>
      <div class="menu-item"><a href="quanlychitieu.html"><i class="fa-solid fa-wallet"></i> Qu·∫£n l√Ω chi ti√™u</a></div>
      <div class="menu-item"><a href="quanlydonhang.html"><i class="fa-solid fa-receipt"></i> Qu·∫£n l√Ω ƒë∆°n h√†ng</a></div>
    </div>
  </div>

  <div id="main">
    <div id="navbar">
      <div id="search">
        <input type="text" placeholder="T√¨m s·∫£n ph·∫©m..." />
        <button><i class="fa-solid fa-magnifying-glass"></i></button>
      </div>
      <div id="profile">
        <div class="myprofile">
          <img src="assets/img/avt/1.jpg" />
          <div class="user-info">
            <p id="name">Nguyen Phuoc Thinh</p>
            <p id="role">Qu·∫£n tr·ªã vi√™n</p>
          </div>
        </div>
        <div id="profile-dropdown">
          <div class="header">
            <img src="assets/img/avt/1.jpg" />
            <div class="info">
              <p class="name">Nguyen Phuoc Thinh</p>
              <button>Xem Profile</button>
            </div>
          </div>
          <ul>
            <li><a href="#">Xem ƒë∆°n ƒë·∫∑t h√†ng</a></li>
            <li><a href="#">C√†i ƒë·∫∑t t√†i kho·∫£n</a></li>
            <li><a href="#">ƒêƒÉng xu·∫•t</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div id="main-content">
      <h3>‚ûï Qu·∫£n l√Ω s·∫£n ph·∫©m</h3>

      
      <form id="productForm" enctype="multipart/form-data">
        <input type="hidden" id="productId" name="id" />
        <label for="tensanpham">T√™n s·∫£n ph·∫©m:</label>
        <input type="text" id="tenSanPham" name="tenSanPham" required />

        <label for="gia">Gi√° ti·ªÅn (VND):</label>
        <input type="number" id="giaTien" name="giaTien" required />

        <label for="hinhanh" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <i class="fa-regular fa-image" style="font-size: 22px; color: #6c5ce7;"></i> Ch·ªçn ·∫£nh s·∫£n ph·∫©m
        </label>
        <input type="file" id="hinhanh" name="hinhAnh" accept="image/*" style="display: none;" />
        <span id="tenFileAnh" style="font-style: italic; font-size: 10px;"></span>

        <button type="submit">üíæ L∆∞u s·∫£n ph·∫©m</button>
      </form>

      <h3 style="margin-top: 30px;">üì¶ Danh s√°ch s·∫£n ph·∫©m</h3>
      <table id="bangSanPham">
        <thead>
          <tr>
            <th>STT</th>
            <th>T√™n s·∫£n ph·∫©m</th>
            <th>Gi√°</th>
            <th>H√¨nh ·∫£nh</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody id="danhSachSanPham">
       
        </tbody>
      </table>
    </div>

    <script>
      $(document).ready(function () {
        loadDanhSach();

      
        $("#hinhanh").on("change", function () {
          const fileName = this.files[0]?.name || "";
          $("#tenFileAnh").text(fileName);
        });

   
        $("#productForm").on("submit", function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          const id = $("#productId").val();

          formData.append("action", id ? "edit" : "add");
          if (id) formData.append("id", id);

          $.ajax({
            url: "quanlysanpham.php",
            type: "POST",
            data: formData,
            contentType: false,
            processData: false,
            success: function () {
              loadDanhSach();
              $("#productForm")[0].reset();
              $("#tenFileAnh").text("");
              $("#productId").val("");
            },
            error: function () {
              alert("‚ùå L·ªói khi g·ª≠i form.");
            }
          });
        });

      
        $(document).on("click", ".xoa-btn", function () {
          const id = $(this).data("id");
          if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")) {
            $.post("quanlysanpham.php", { action: "delete", id: id }, function () {
              loadDanhSach();
            });
          }
        });

       
        $(document).on("click", ".sua-btn", function () {
          const id = $(this).data("id");

          $.post("quanlysanpham.php", { action: "get", id: id }, function (data) {
            const sp = JSON.parse(data);
            $("#tenSanPham").val(sp.tensanpham);
            $("#giaTien").val(sp.gia);
            $("#productId").val(sp.id);
            $("#tenFileAnh").text("");
            $("#hinhanh").val("");
          });
        });
      });

      function loadDanhSach() {
        $("#danhSachSanPham").load("quanlysanpham.php");
      }
    </script>
</body>
</html>
